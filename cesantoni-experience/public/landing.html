<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Cesantoni Experience</title>

    <!-- SEO Meta Tags (updated dynamically) -->
    <meta name="description" id="meta-description" content="Descubre pisos y azulejos de la m√°s alta calidad. Cesantoni - Experiencia en pisos.">
    <meta name="keywords" content="pisos, azulejos, porcelanato, m√°rmol, cesantoni, pisos de lujo">
    <meta name="author" content="Cesantoni">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="product">
    <meta property="og:title" id="og-title" content="Cesantoni Experience">
    <meta property="og:description" id="og-description" content="Descubre pisos y azulejos de la m√°s alta calidad.">
    <meta property="og:image" id="og-image" content="https://www.cesantoni.com.mx/wp-content/uploads/cesantoni-logo.png">
    <meta property="og:url" id="og-url" content="">
    <meta property="og:site_name" content="Cesantoni">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="tw-title" content="Cesantoni Experience">
    <meta name="twitter:description" id="tw-description" content="Descubre pisos y azulejos de la m√°s alta calidad.">
    <meta name="twitter:image" id="tw-image" content="">

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cesantoni-green: #8BC34A;
            --cesantoni-green-dark: #689F38;
            --cesantoni-gold: #C9A227;
            --cesantoni-dark: #1a1a1a;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Source Sans 3', sans-serif;
            background: #fafafa;
            color: var(--cesantoni-dark);
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: var(--cesantoni-dark);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            color: white;
            font-size: 1.3rem;
        }
        
        .logo span {
            color: var(--cesantoni-green);
            font-size: 0.7rem;
            display: block;
            font-family: 'Source Sans 3', sans-serif;
            font-weight: 300;
        }
        
        /* Hero */
        .hero {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 40px 20px;
            text-align: center;
            color: white;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .hero .subtitle {
            color: rgba(255,255,255,0.7);
            font-size: 1.1rem;
        }
        
        /* Video placeholder */
        .video-container {
            max-width: 600px;
            margin: 30px auto 0;
            background: #333;
            border-radius: 16px;
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-placeholder {
            text-align: center;
            color: rgba(255,255,255,0.5);
        }
        
        .video-placeholder .icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        /* Content */
        .content {
            max-width: 600px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* Promo Banner */
        .promo-banner {
            background: linear-gradient(135deg, var(--cesantoni-gold) 0%, #d4a832 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(201, 162, 39, 0.3);
        }
        
        .promo-banner .discount {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
        }
        
        .promo-banner .text {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* Price Card */
        .price-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }
        
        .price-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 4px;
        }
        
        .price-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--cesantoni-dark);
        }
        
        .price-unit {
            font-size: 1rem;
            color: #888;
            font-weight: 400;
        }
        
        /* Specs Grid */
        .specs-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }
        
        .specs-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .specs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .spec-item {
            padding: 12px;
            background: #f8f8f8;
            border-radius: 10px;
        }
        
        .spec-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .spec-value {
            font-weight: 600;
            color: var(--cesantoni-dark);
            margin-top: 4px;
        }
        
        /* Store Section */
        .store-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }
        
        .store-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            margin-bottom: 16px;
        }
        
        .store-info {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        
        .store-icon {
            width: 50px;
            height: 50px;
            background: var(--cesantoni-green);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .store-details h3 {
            font-size: 1.1rem;
            margin-bottom: 4px;
        }
        
        .store-details p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .store-address {
            margin-top: 16px;
            padding: 16px;
            background: #f8f8f8;
            border-radius: 10px;
        }
        
        .store-address .label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
        }
        
        .store-address .address {
            margin-top: 4px;
            font-weight: 500;
        }
        
        /* Map */
        .map-container {
            margin-top: 16px;
            border-radius: 12px;
            overflow: hidden;
            height: 200px;
        }
        
        .map-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* WhatsApp Button */
        .whatsapp-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 18px 24px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            margin-bottom: 16px;
        }
        
        .whatsapp-btn:hover {
            background: #1da851;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.35);
        }
        
        .whatsapp-btn .icon {
            font-size: 1.4rem;
        }
        
        /* Floating WhatsApp */
        .floating-wa {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            text-decoration: none;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
            z-index: 100;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #888;
            font-size: 0.85rem;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: #888;
        }
        
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #eee;
            border-top-color: var(--cesantoni-green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 12px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Error state */
        .error {
            text-align: center;
            padding: 60px 20px;
        }
        
        .error h2 {
            font-size: 4rem;
            margin-bottom: 16px;
        }
        
        .error p {
            color: #666;
            font-size: 1.1rem;
        }

        /* Gallery Section */
        .gallery-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .gallery-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            margin-bottom: 16px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .gallery-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .gallery-item:hover {
            transform: scale(1.05);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Room Visualizer */
        .visualizer-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .visualizer-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            margin-bottom: 16px;
        }

        .room-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .room-tab {
            padding: 8px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .room-tab.active {
            background: var(--cesantoni-green);
            color: white;
        }

        .room-tab:hover:not(.active) {
            background: #e0e0e0;
        }

        .room-image {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }

        .room-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            background: none;
            border: none;
        }

        /* PDF Button */
        .pdf-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            background: #e53935;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            margin-top: 12px;
            transition: all 0.2s;
        }

        .pdf-btn:hover {
            background: #c62828;
        }

        /* Uses Tags */
        .uses-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .use-tag {
            padding: 6px 12px;
            background: var(--cesantoni-green);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">
            <div class="spinner"></div>
            Cargando producto...
        </div>
    </div>

    <script>
        // =====================================================
        // CONFIG
        // =====================================================
        const API = '/api';
        
        // Generate session ID for tracking
        const sessionId = 'sess_' + Math.random().toString(36).substr(2, 9);
        
        // Parse URL params
        const urlParams = new URLSearchParams(window.location.search);
        const params = {
            tienda: urlParams.get('tienda') || '',
            estado: urlParams.get('estado') || '',
            ciudad: urlParams.get('ciudad') || '',
            dir: urlParams.get('dir') || '',
            wa: urlParams.get('wa') || '',
            promo: urlParams.get('promo') || '',
            precio: urlParams.get('precio') || ''
        };
        
        // Get SKU from URL path
        const pathParts = window.location.pathname.split('/');
        const sku = pathParts[pathParts.length - 1];
        
        // State
        let product = null;
        let store = null;
        let scanId = null;
        
        // =====================================================
        // INIT
        // =====================================================
        async function init() {
            try {
                // Load product
                const res = await fetch(`${API}/landing/${sku}`);
                if (!res.ok) throw new Error('Producto no encontrado');
                product = await res.json();
                
                // Try to find store by slug
                if (params.tienda) {
                    const stores = await fetch(`${API}/stores`).then(r => r.json());
                    const [distSlug, storeSlug] = params.tienda.split('-');
                    store = stores.find(s => 
                        s.slug === storeSlug || 
                        params.tienda.includes(s.slug)
                    );
                }
                
                // Track scan
                await trackScan();
                
                // Render page
                render();
                
            } catch (err) {
                console.error(err);
                renderError();
            }
        }
        
        // =====================================================
        // TRACKING
        // =====================================================
        async function trackScan() {
            try {
                const res = await fetch(`${API}/track/scan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        product_id: product.id,
                        store_id: store?.id || null,
                        session_id: sessionId,
                        utm_source: urlParams.get('utm_source'),
                        utm_medium: urlParams.get('utm_medium'),
                        utm_campaign: urlParams.get('utm_campaign')
                    })
                });
                const data = await res.json();
                scanId = data.scan_id;
                console.log('Scan tracked:', scanId);
            } catch (err) {
                console.error('Error tracking scan:', err);
            }
        }
        
        async function trackWhatsAppClick() {
            try {
                await fetch(`${API}/track/whatsapp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        scan_id: scanId,
                        product_id: product.id,
                        store_id: store?.id || null,
                        session_id: sessionId,
                        whatsapp_number: getWhatsAppNumber()
                    })
                });
                console.log('WhatsApp click tracked');
            } catch (err) {
                console.error('Error tracking WA click:', err);
            }
        }
        
        // =====================================================
        // HELPERS
        // =====================================================
        function getWhatsAppNumber() {
            return params.wa || store?.whatsapp || '525512345678';
        }
        
        function getWhatsAppURL() {
            const number = getWhatsAppNumber();
            const storeName = store?.name || params.tienda || 'la tienda';
            const message = encodeURIComponent(
                `Hola! Vi el producto ${product.name} en ${storeName} y me gustar√≠a m√°s informaci√≥n.`
            );
            return `https://wa.me/${number}?text=${message}`;
        }
        
        function getPrice() {
            if (params.precio) return parseFloat(params.precio);
            return product.base_price || 0;
        }
        
        function getPromoDiscount() {
            return params.promo || store?.promo_discount || '';
        }
        
        function getPromoText() {
            return store?.promo_text || 'Promoci√≥n especial';
        }
        
        function getMapURL() {
            const address = params.dir || store?.address || '';
            const city = params.ciudad || store?.city || '';
            const state = params.estado || store?.state || '';
            const query = encodeURIComponent(`${address}, ${city}, ${state}, M√©xico`);
            return `https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=${query}`;
        }
        
        // =====================================================
        // RENDER
        // =====================================================
        function updateSEO() {
            const title = `${product.name} - Piso ${product.category || ''} | Cesantoni`;
            const desc = product.description || `${product.name} - ${product.type || 'Porcelanato'} ${product.format || ''}. Calidad premium Cesantoni.`;
            const img = product.image_url || '';
            const url = window.location.href;

            document.getElementById('page-title').textContent = title;
            document.getElementById('meta-description').content = desc;
            document.getElementById('og-title').content = title;
            document.getElementById('og-description').content = desc;
            document.getElementById('og-image').content = img;
            document.getElementById('og-url').content = url;
            document.getElementById('tw-title').content = title;
            document.getElementById('tw-description').content = desc;
            document.getElementById('tw-image').content = img;
        }

        function getGalleryImages() {
            if (!product.gallery) return [];
            try {
                const gallery = JSON.parse(product.gallery);
                return Array.isArray(gallery) ? gallery.slice(0, 6) : [];
            } catch { return []; }
        }

        function getRoomImages() {
            const images = getGalleryImages();
            const rooms = { sala: [], cocina: [], bano: [], recamara: [], exterior: [] };

            images.forEach(url => {
                const lower = url.toLowerCase();
                if (lower.includes('sala') || lower.includes('living')) rooms.sala.push(url);
                else if (lower.includes('cocina') || lower.includes('kitchen')) rooms.cocina.push(url);
                else if (lower.includes('bano') || lower.includes('bath')) rooms.bano.push(url);
                else if (lower.includes('recamara') || lower.includes('habitacion') || lower.includes('bedroom')) rooms.recamara.push(url);
                else if (lower.includes('exterior') || lower.includes('terraza')) rooms.exterior.push(url);
                else if (rooms.sala.length === 0) rooms.sala.push(url);
            });

            return rooms;
        }

        function renderGallery() {
            const images = getGalleryImages();
            if (images.length === 0) return '';

            return `
                <div class="gallery-section">
                    <h2>Galer√≠a</h2>
                    <div class="gallery-grid">
                        ${images.map((img, i) => `
                            <div class="gallery-item" onclick="openLightbox('${img}')">
                                <img src="${img}" alt="Vista ${i+1}" loading="lazy">
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderVisualizer() {
            const rooms = getRoomImages();
            const availableRooms = Object.entries(rooms).filter(([_, imgs]) => imgs.length > 0);
            if (availableRooms.length === 0) return '';

            const roomNames = { sala: 'Sala', cocina: 'Cocina', bano: 'Ba√±o', recamara: 'Rec√°mara', exterior: 'Exterior' };
            const firstRoom = availableRooms[0];

            return `
                <div class="visualizer-section">
                    <h2>Visualiza en tu Espacio</h2>
                    <div class="room-tabs">
                        ${availableRooms.map(([room, _], i) => `
                            <button class="room-tab ${i === 0 ? 'active' : ''}" onclick="switchRoom('${room}')">${roomNames[room]}</button>
                        `).join('')}
                    </div>
                    <div class="room-image" id="room-display">
                        <img src="${firstRoom[1][0]}" alt="${roomNames[firstRoom[0]]}">
                    </div>
                </div>
            `;
        }

        function switchRoom(room) {
            const rooms = getRoomImages();
            if (!rooms[room] || rooms[room].length === 0) return;

            document.querySelectorAll('.room-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('room-display').innerHTML = `<img src="${rooms[room][0]}" alt="${room}">`;
        }

        function openLightbox(src) {
            const lightbox = document.getElementById('lightbox');
            lightbox.querySelector('img').src = src;
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        function render() {
            updateSEO();

            const promo = getPromoDiscount();
            const price = getPrice();
            const storeName = store?.name || decodeURIComponent(params.tienda).replace(/-/g, ' ') || 'Distribuidor Autorizado';
            const storeCity = params.ciudad || store?.city || '';
            const storeState = params.estado || store?.state || '';
            const storeAddress = params.dir ? decodeURIComponent(params.dir).replace(/\+/g, ' ') : store?.address || '';
            
            document.getElementById('app').innerHTML = `
                <!-- Header -->
                <header class="header">
                    <div class="logo">
                        Cesantoni
                        <span>Experience</span>
                    </div>
                </header>
                
                <!-- Hero -->
                <section class="hero">
                    <h1>${product.name}</h1>
                    <p class="subtitle">${product.finish || ''} ‚Ä¢ ${product.format || ''}</p>
                    
                    <div class="video-container">
                        ${product.video_url 
                            ? `<video autoplay muted loop playsinline><source src="${product.video_url}" type="video/mp4"></video>`
                            : `<div class="video-placeholder"><div class="icon">üé¨</div><div>Video pr√≥ximamente</div></div>`
                        }
                    </div>
                </section>
                
                <!-- Content -->
                <div class="content">
                    ${promo ? `
                        <div class="promo-banner">
                            <div class="discount">${promo} OFF</div>
                            <div class="text">${getPromoText()}</div>
                        </div>
                    ` : ''}
                    
                    <!-- Price -->
                    <div class="price-card">
                        <div class="price-label">Precio desde</div>
                        <div class="price-value">
                            $${price.toLocaleString()}
                            <span class="price-unit">MXN / m¬≤</span>
                        </div>
                        
                        <a href="${getWhatsAppURL()}" class="whatsapp-btn" onclick="handleWhatsAppClick(event)" style="margin-top: 20px;">
                            <span class="icon">üí¨</span>
                            Cotizar por WhatsApp
                        </a>
                    </div>
                    
                    <!-- Specs -->
                    <div class="specs-section">
                        <h2>Especificaciones T√©cnicas</h2>
                        <div class="specs-grid">
                            <div class="spec-item">
                                <div class="spec-label">Formato</div>
                                <div class="spec-value">${product.format || '-'}</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Tipo</div>
                                <div class="spec-value">${product.type || '-'}</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Acabado</div>
                                <div class="spec-value">${product.finish || '-'}</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Resistencia</div>
                                <div class="spec-value">${product.resistance || '-'}</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Absorci√≥n</div>
                                <div class="spec-value">${product.water_absorption || '-'}</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">MOHS</div>
                                <div class="spec-value">${product.mohs || '-'}</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">Piezas/Caja</div>
                                <div class="spec-value">${product.pieces_per_box || '-'}</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-label">m¬≤/Caja</div>
                                <div class="spec-value">${product.sqm_per_box || '-'}</div>
                            </div>
                        </div>
                        
                        ${product.usage ? `
                            <div style="margin-top: 16px; padding: 16px; background: #f8f8f8; border-radius: 10px;">
                                <div class="spec-label">Uso Recomendado</div>
                                <div class="spec-value">${product.usage}</div>
                            </div>
                        ` : ''}

                        ${product.uses ? `
                            <div class="uses-tags">
                                ${product.uses.split(',').map(u => `<span class="use-tag">${u.trim()}</span>`).join('')}
                            </div>
                        ` : ''}

                        ${product.pdf_url ? `
                            <a href="${product.pdf_url}" target="_blank" class="pdf-btn">
                                üìÑ Ficha T√©cnica PDF
                            </a>
                        ` : ''}
                    </div>

                    <!-- Gallery -->
                    \${renderGallery()}

                    <!-- Room Visualizer -->
                    \${renderVisualizer()}

                    <!-- Store -->
                    <div class="store-section">
                        <h2>Disponible en</h2>
                        <div class="store-info">
                            <div class="store-icon">üè™</div>
                            <div class="store-details">
                                <h3>${storeName}</h3>
                                <p>${storeCity}${storeState ? `, ${storeState}` : ''}</p>
                            </div>
                        </div>
                        
                        ${storeAddress ? `
                            <div class="store-address">
                                <div class="label">Direcci√≥n</div>
                                <div class="address">${storeAddress}</div>
                            </div>
                            
                            <div class="map-container">
                                <iframe src="${getMapURL()}" loading="lazy"></iframe>
                            </div>
                        ` : ''}
                        
                        <a href="${getWhatsAppURL()}" class="whatsapp-btn" onclick="handleWhatsAppClick(event)" style="margin-top: 20px;">
                            <span class="icon">üí¨</span>
                            Contactar Tienda
                        </a>
                    </div>
                </div>
                
                <!-- Footer -->
                <footer class="footer">
                    <p>¬© 2025 Cesantoni. Todos los derechos reservados.</p>
                    <p style="margin-top: 8px;">Precios sujetos a cambio sin previo aviso.</p>
                </footer>
                
                <!-- Floating WhatsApp -->
                <a href="${getWhatsAppURL()}" class="floating-wa" onclick="handleWhatsAppClick(event)">üí¨</a>

                <!-- Lightbox -->
                <div class="lightbox" id="lightbox" onclick="closeLightbox()">
                    <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
                    <img src="" alt="Vista ampliada">
                </div>
            `;
        }
        
        function renderError() {
            document.getElementById('app').innerHTML = `
                <header class="header">
                    <div class="logo">
                        Cesantoni
                        <span>Experience</span>
                    </div>
                </header>
                
                <div class="error">
                    <h2>üîç</h2>
                    <h3>Producto no encontrado</h3>
                    <p>El producto que buscas no existe o fue removido.</p>
                </div>
            `;
        }
        
        // =====================================================
        // EVENT HANDLERS
        // =====================================================
        function handleWhatsAppClick(event) {
            // Track the click before navigating
            trackWhatsAppClick();
            // Don't prevent default - let the link work
        }
        
        // Make functions available globally
        window.handleWhatsAppClick = handleWhatsAppClick;
        window.switchRoom = switchRoom;
        window.openLightbox = openLightbox;
        window.closeLightbox = closeLightbox;
        
        // =====================================================
        // START
        // =====================================================
        init();
    </script>
</body>
</html>
